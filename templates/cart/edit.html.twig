{% extends 'base.html.twig' %}

{% block title %}Edit Cart{% endblock %}

{% block body %}
    <h1>Edit Cart Of Refrence {{ cart.cartRef }}</h1>

    {{ include('cart/_form.html.twig', {'button_label': 'Update'}) }}

    <a href="{{ path('app_cart_index') }}">back to list</a>

    {{ include('cart/_delete_form.html.twig') }}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function() {
        $('form').submit(function(event) {
            var uid = $('#cart_uid').val(); // Assuming the input ID for UID is "cart_uid"
            var artRef = $('#cart_art_ref').val(); // Assuming the input ID for artRef is "cart_art_ref"

            if (!isValidUid(uid) || !isValidArtRef(artRef)) {
                event.preventDefault(); // Prevent the form from submitting
                alert("Invalid UID or artRef. Please correct the errors.");
            }
               $.ajax({
                url: '{{ path('check_art') }}',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ uid: uid, art_ref: artRef }),
                success: function(response) {
                    // Check the response from the server
                    if (response === 'UID and artRef exist') {
                        $('form').unbind('submit').submit(); // Submit the form if both UID and artRef exist
                    } else {
                         event.preventDefault();
                        alert("UID or artRef does not exist.");
                    }
                },
                error: function(xhr, status, error) {
                     event.preventDefault();
                    alert("An error occurred while validating UID and artRef.");
                    console.error(xhr.responseText);
                }
            });
        });
    });

    function isValidUid(uid) {
        return /^\d+$/.test(uid) && parseInt(uid) > 0;
    }

    function isValidArtRef(artRef) {
        return /^\d+$/.test(artRef) && parseInt(artRef) > 0;
    }
    </script>
{% endblock %}
